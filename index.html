<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classroom Quiet Monitor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body, html {
            height: 100%;
            overflow: hidden;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        
        .fullscreen-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #325c1c url('background.jpg') center center;
            background-size: cover;
            background-repeat: no-repeat;
        }
        
        /* Top left controls - compact and discreet */
        .controls-left {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            width: 300px;
            font-size: 0.9em;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-group:last-child {
            margin-bottom: 0;
        }
        
        .control-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
            font-size: 0.9em;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.8em;
        }
        
        .slider {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .slider-value {
            font-weight: bold;
            min-width: 30px;
            text-align: center;
            background: #f0f0f0;
            padding: 3px 8px;
            border-radius: 8px;
            font-size: 0.8em;
        }
        
        .volume-indicator {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .volume-bar {
            height: 100%;
            background: linear-gradient(90deg, #4caf50 0%, #ffeb3b 70%, #f44336 100%);
            width: 0%;
            transition: width 0.1s ease;
            border-radius: 6px;
        }
        
        /* Top right timer - large and visible */
        .timer-container {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            padding: 30px 40px;
            box-shadow: 0 6px 30px rgba(0,0,0,0.3);
        }
        
        .timer-label {
            color: white;
            font-size: 1.5em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .timer-display {
            font-size: 4em;
            font-weight: bold;
            text-align: center;
            color: #4caf50;
            font-family: 'Courier New', monospace;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            border: 3px solid #4caf50;
            border-radius: 15px;
            padding: 20px 30px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            min-width: 200px;
        }
        
        /* Center mascot - large and prominent */
        .mascot-container {
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 5;
        }
        
        .mascot {
            width: 15rem;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.2));
        }
        
        .mascot.sleeping {
            /* animation: sleep 3s ease-in-out infinite; */
        }
        
        .mascot.awake {
          content:url("awakening.png");
          /* background-image: ; */
            /* animation: bounce 0.6s ease-in-out infinite; */
        }
        
        .mascot-shadow {
            width: 16rem;
            height: 5rem;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            position: absolute;
            top: 75%;
            left: 50%;
            z-index: -1;
            transform: translateX(-50%);
            filter: blur(12px);
        }

        /* @keyframes sleep {
            0%, 100% { transform: scale(1) rotate(-2deg); }
            50% { transform: scale(1.05) rotate(2deg); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-20px) scale(1.1); }
        } */
        
        .message {
            position: absolute;
            top: 5%;
            left: 50%;
            z-index: 15;
            transform: translateX(-50%);
            font-size: 2.5em;
            font-weight: bold;
            margin-top: 20px;
            padding: 20px 40px;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            max-width: 600px;
        }
        
        .message.quiet {
            color: #2e7d32;
            border: 3px solid #4caf50;
        }
        
        .message.noisy {
            color: #c62828;
            border: 3px solid #f44336;
            /* animation: pulse 1s ease-in-out infinite; */
            background: rgba(255, 235, 235, 0.95);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.02); }
        }
        
        /* Fullscreen shake effect when noisy */
        .fullscreen-container.noisy {
            /* animation: shake 0.5s ease-in-out infinite; */
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* Start button - bottom center */
        .start-button-container {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .start-button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 1.5em;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            font-family: inherit;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            z-index: 10;
        }
        
        .start-button:hover {
            background: #45a049;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }
        
        .start-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .start-button.stop {
            background: #f44336;
        }
        
        .start-button.stop:hover {
            background: #d32f2f;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .controls-left {
                width: 250px;
                padding: 15px;
            }
            
            .timer-display {
                font-size: 3em;
                padding: 15px 20px;
            }
            
            .timer-label {
                font-size: 1.2em;
            }
            
            .mascot {
                font-size: 10em;
            }
            
            .message {
                font-size: 2em;
                padding: 15px 30px;
                max-width: 500px;
            }
        }
        
        @media (max-height: 600px) {
            .mascot {
                font-size: 8em;
            }
            
            .message {
                font-size: 1.8em;
                padding: 10px 20px;
            }
            
            .timer-display {
                font-size: 2.5em;
            }
        }
    </style>
</head>
<body>
    <div class="fullscreen-container" id="fullscreenContainer">
        <!-- Top Left Controls -->
        <div class="controls-left">
            <div class="control-group">
                <label class="control-label">üéöÔ∏è Noise Sensitivity</label>
                <div class="slider-container">
                    <span>Low</span>
                    <input type="range" class="slider" id="sensitivitySlider" min="10" max="90" value="30">
                    <span>High</span>
                    <div class="slider-value" id="sensitivityValue">30</div>
                </div>
            </div>
            
            <div class="control-group">
                <label class="control-label">üìä Volume Level</label>
                <div class="volume-indicator">
                    <div class="volume-bar" id="volumeBar"></div>
                </div>
            </div>
        </div>
        
        <!-- Top Right Timer -->
        <div class="timer-container">
            <div class="timer-label">‚è±Ô∏è Quiet Time</div>
            <div class="timer-display" id="timerDisplay">00:00</div>
        </div>

        <!-- Center Message -->
        <div class="message quiet" id="message">Click 'Start Monitoring' to begin!</div>
        
        <!-- Center Mascot -->
        <div class="mascot-container">
          <div class="mascot-shadow"></div>
          <img class="mascot sleeping" id="mascot" src="sleeping.png" alt="Mascot"/>
        </div>
        
        <!-- Bottom Center Start Button -->
        <div class="start-button-container">
            <button class="start-button" id="startButton">‚ñ∂Ô∏è Start Monitoring</button>
        </div>
    </div>

    <script>
        class NoiseMonitor {
            constructor() {
                this.audioContext = null;
                this.microphone = null;
                this.analyzer = null;
                this.isMonitoring = false;
                this.isQuiet = true;
                this.quietStartTime = null;
                this.totalQuietTime = 0;
                this.sensitivity = 30;
                
                this.mascot = document.getElementById('mascot');
                this.fullscreenContainer = document.getElementById('fullscreenContainer');
                this.message = document.getElementById('message');
                this.startButton = document.getElementById('startButton');
                this.sensitivitySlider = document.getElementById('sensitivitySlider');
                this.sensitivityValue = document.getElementById('sensitivityValue');
                this.timerDisplay = document.getElementById('timerDisplay');
                this.volumeBar = document.getElementById('volumeBar');
                
                this.quietMessages = [
                    "üò¥ Zzz... So peaceful and quiet!",
                    "üåô Sweet dreams in our quiet forest...",
                    "üçÉ Perfect silence! Keep it up!",
                    "‚ú® Sleeping soundly in nature...",
                    "ü¶ã So calm and peaceful!"
                ];
                
                this.noisyMessages = [
                    "üò± Please, quiet! ü§´",
                    "üêª Shhhh! You woke me up!",
                    "üò¥ Too noisy! Please whisper!",
                    "üåô Let me sleep peacefully!",
                    "ü§´ Quiet voices, please!",
                    "üòÆ Inside voices only!"
                ];
                
                this.setupEventListeners();
                this.updateTimer();
            }
            
            setupEventListeners() {
                this.startButton.addEventListener('click', () => {
                    if (this.isMonitoring) {
                        this.stopMonitoring();
                    } else {
                        this.startMonitoring();
                    }
                });
                
                this.sensitivitySlider.addEventListener('input', (e) => {
                    this.sensitivity = parseInt(e.target.value);
                    this.sensitivityValue.textContent = this.sensitivity;
                });
            }
            
            async startMonitoring() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.microphone = this.audioContext.createMediaStreamSource(stream);
                    this.analyzer = this.audioContext.createAnalyser();
                    
                    this.analyzer.fftSize = 256;
                    this.analyzer.smoothingTimeConstant = 0.8;
                    this.microphone.connect(this.analyzer);
                    
                    this.isMonitoring = true;
                    this.startButton.textContent = '‚èπÔ∏è Stop Monitoring';
                    this.startButton.classList.add('stop');
                    
                    this.quietStartTime = Date.now();
                    this.monitorNoise();
                    
                } catch (error) {
                    console.error('Error accessing microphone:', error);
                    alert('Could not access microphone. Please make sure you grant permission and try again.');
                }
            }
            
            stopMonitoring() {
                this.isMonitoring = false;
                if (this.audioContext) {
                    this.audioContext.close();
                }
                this.startButton.textContent = '‚ñ∂Ô∏è Start Monitoring';
                this.startButton.classList.remove('stop');
                this.resetToQuiet();
            }
            
            monitorNoise() {
                if (!this.isMonitoring) return;
                
                const dataArray = new Uint8Array(this.analyzer.frequencyBinCount);
                this.analyzer.getByteFrequencyData(dataArray);
                
                // Calculate average volume
                const average = dataArray.reduce((sum, value) => sum + value, 0) / dataArray.length;
                const volumePercent = Math.min(100, (average / 255) * 100);
                
                // Update volume indicator
                this.volumeBar.style.width = volumePercent + '%';
                
                // Check if noise level exceeds sensitivity threshold
                const threshold = ((100 - this.sensitivity) / 100) * 100;
                const isCurrentlyNoisy = volumePercent > threshold;
                
                if (isCurrentlyNoisy && this.isQuiet) {
                    this.setNoisy();
                } else if (!isCurrentlyNoisy && !this.isQuiet) {
                    this.setQuiet();
                }
                
                this.updateTimer();
                requestAnimationFrame(() => this.monitorNoise());
            }
            
            setNoisy() {
                this.isQuiet = false;
                // this.mascot.textContent = 'üò±';
                this.mascot.className = 'mascot awake';
                this.mascot.attributes.scr
                this.fullscreenContainer.classList.add('noisy');
                this.message.textContent = this.getRandomMessage(this.noisyMessages);
                this.message.className = 'message noisy';
                
                // Reset timer when noise is detected
                this.totalQuietTime = 0;
                this.quietStartTime = null;
            }
            
            setQuiet() {
                this.isQuiet = true;
                // this.mascot.textContent = 'üêª';
                this.mascot.className = 'mascot sleeping';
                this.fullscreenContainer.classList.remove('noisy');
                this.message.textContent = this.getRandomMessage(this.quietMessages);
                this.message.className = 'message quiet';
                
                this.quietStartTime = Date.now();
            }
            
            resetToQuiet() {
                this.isQuiet = true;
                this.mascot.textContent = 'üêª';
                this.mascot.className = 'mascot sleeping';
                this.fullscreenContainer.classList.remove('noisy');
                this.message.textContent = "Click 'Start Monitoring' to begin!";
                this.message.className = 'message quiet';
                this.volumeBar.style.width = '0%';
                this.totalQuietTime = 0;
                this.quietStartTime = null;
            }
            
            getRandomMessage(messages) {
                return messages[Math.floor(Math.random() * messages.length)];
            }
            
            updateTimer() {
                let currentQuietTime = 0;
                if (this.quietStartTime && this.isQuiet) {
                    currentQuietTime = Date.now() - this.quietStartTime;
                }
                
                const minutes = Math.floor(currentQuietTime / 60000);
                const seconds = Math.floor((currentQuietTime % 60000) / 1000);
                
                this.timerDisplay.textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (this.isMonitoring) {
                    setTimeout(() => this.updateTimer(), 1000);
                }
            }
        }
        
        // Initialize the noise monitor when the page loads
        const monitor = new NoiseMonitor();
    </script>
</body>
</html>